@use "../utils/typography";
@use "../utils/colors";
@use "../utils/variables";

// Local variables
$bg-light: #eeede0;
$bg-parchment: #f7f3e8;
$border-dark: #272727;
$border-medium: #888;
$border-light: #c9c7b8;
$text-dark: #222;
$space-bar-over: #691313;
$bg-transparent-light: rgba(0, 0, 0, 0.05);
$border-transparent-medium: rgba(39, 39, 39, 0.25);

// Mixins
@mixin flex-center {
	display: flex;
	justify-content: center;
	align-items: center;
}

@mixin item-header {
	height: 28px;
	margin: 2px 0;
	padding: 0;
	align-items: center;
	background: $bg-transparent-light;
	border: variables.$border-groove;
	font-weight: bold;
}

.application.theme-light {
	background: url('../media/parchment.jpg') repeat;
	--color-header-background: #333;
	--color-border: #302831;
	--color-tabs-border: #555;
	--color-fieldset-border: #efe6d8;
	--color-form-label: $text-dark;
	--color-form-label-hover: #111;
	--color-form-hint: #444;
	--color-form-hint-hover: $text-dark;
	--color-select-option-bg: $bg-parchment;
	color: $text-dark;
	
	input, select { color: $text-dark !important; }
}

section.itemsheet, form.ordemparanormal.actor {
	overflow: hidden;
	color: $text-dark;

	.scrollable {
		box-sizing: border-box;
		width: 100%;
		padding: 0;
	}

	.prosemirror menu, prosemirror menu {
		background: $bg-light;
	}

	section.window-content {
		position: relative;
		display: flex;
		background: $bg-light;
		height: 100%;

		input {
			text-align: center;
		}

		.tab {
			padding-top: 10px;
			height: 100%;
			overflow: auto;

			&.active {
				display: flex;
				flex-direction: column;
			}

			&[data-tab="inventory"] {
				overflow: hidden;
				padding-bottom: 20px;
				.inventory-body {
					margin-bottom: 5px;
					overflow: auto;
					height: 100%;
				}
			}
		}
		
		header.sheet-header-op {
			display: flex;
			flex-direction: column;
			margin-bottom: 10px;

			.progress {
				padding-left: 10px;

				input {
					width: 40px;
				}
			}
			
			.profile-img {
				flex: 0 0 48px;
				height: 48px;
				margin-right: 10px;
			}

			h1.charname {
				height: 45px;
				padding: 0px;
				margin: 5px 0;
				border-bottom: 0;
				input {
					min-width: 235px;
					width: 100%;
					height: 100%;
					margin: 0;
				}
			}

			.header-identify {
				@include flex-center;

				h1, h2, h3, h4 { border: 0; }

				h1.charname {
					@include flex-center;
					width: 100%;
					margin: 0;

					input {
						font-size: 0.6em;
						font-family: 'Signika';
					}
				}

			}
		}

	section.inventory-prestige {
		position: relative;
		justify-content: center;
		align-items: center;
		width: 100%;
		background-color: $bg-light;

		.patents {
			display: flex;
			padding: 0 6px;
			gap: 8px;
			margin-bottom: 8px;

			.limit {
				display: flex;
				border: 1px solid $border-medium;
				border-radius: 4px;
				width: 44px;
				height: 32px;
				text-align: center;
			}

			.prestige {
				display: flex;
				flex: 1;
				text-align: center;
				font-size: 12px;
			}

			.name, .credit {
				@include flex-center;
				flex-grow: 1;
				padding: 4px 6px;
				border: 1px solid $border-medium;
				border-radius: 4px;
				background-color: $bg-transparent-light;
				font-weight: bold;
			}
		}
	}

	section.space {
		position: relative;
		width: 100%;

		.space-body {
			position: absolute;
			border: 1px solid $border-dark;
			border-radius: 3px;
			width: 100%;
			height: 13px;

			.spacelabel {
				position: absolute;
				z-index: 12;
				color: #fff;
				font-size: 9px;
				padding: 1px 4px;
				mix-blend-mode: difference;
			}

			.bar {
				display: block !important;
				margin: 0;
				border-radius: 2px;
				background-color: $border-dark;
				height: 12px;
				z-index: 10;
				overflow: hidden;
			}

			.barover {
				position: absolute;
				top: 0;
				left: 0;
				display: block !important;
				border-radius: 2px;
				background-color: $space-bar-over;
				height: 12px;
				color: colors.$c-white;
				font-size: 9px;
				z-index: 11;
				padding-top: 6px;
				overflow: hidden;
			}

			.label, i {
				position: absolute;
				top: 0px;
				font-size: 10px;
				z-index: 12;
				mix-blend-mode: difference;
				filter: invert(1);
			}

			i {
				color: rgb(0, 0, 0);
				left: 50%;
			}

			.label {
				right: 20px;
			}
		}
	}

	span.actor-title-header {
		@include flex-center;
		background: $bg-transparent-light;
		border: 2px groove $bg-light;
		padding: 4px;
	}
	}

	.items-list {
	list-style: none;
	margin: 0;
	padding: 0;
	overflow-y: auto;
	scrollbar-width: thin;
	color: colors.$c-tan;

	.item-list {
		list-style: none;
		margin: 0;
		padding: 0;
	}

	.item-name {
		flex: 2;
		margin: 0;
		overflow: hidden;
		text-align: left;
		align-items: center;
		display: flex;

		h3, h4 {
			color: $text-dark;
			font-size: 13px;
			margin: 0;
			white-space: nowrap;
			overflow: hidden;
			text-shadow: none;
			font-family: 'Signika';
		}
	}

	// Control Buttons
	.item-controls {
		display: flex;
		flex: 0 0 100px;
		justify-content: flex-end;
		a {
			font-size: 12px;
			text-align: center;
			margin: 0 6px;
		}
	}

	.item {
		align-items: center;
		padding: 0 2px;
		border-bottom: 1px solid colors.$c-faint;
		
		&:last-child { border-bottom: none; }
		
		.item-name {
			color: colors.$c-dark;
			
			.item-image {
				display: flex;
				align-items: center;
				flex: 0 0 30px;
				height: 30px;
				background-size: 30px;
				border: none;
				margin-right: 1px;
			}
		}
	}

	.item-prop {
		text-align: center;
		border-left: 1px solid $border-light;
		border-right: 1px solid $border-light;
		font-size: 12px;
	}

	.items-header {
		@include item-header;
		
		> * {
			font-size: 12px;
			text-align: center;
		}
		
		.item-name {
			padding-left: 5px;
			text-align: left;
		}
	}
	}
}

.sheet-body {
	overflow: hidden;
	
	.tab {
		overflow-y: hidden;
		align-content: flex-start;
		padding-right: 2px;
		height: 100%;
		min-height: 150px;
		
		&.skills, &.inventory, &.abilities, &.rituals, &.biography, &.effects {
			overflow-y: auto;
		}
		
		.editor {
			height: 100%;
			min-height: 150px;
		}
	}
}

.window-content { overflow: hidden; }
.item-form { font-family: typography.$font-primary; }
.sheet-tabs { flex: 0; }

.tox {
	.tox-editor-container {
		background: colors.$c-white;
	}

	.tox-edit-area {
		padding: 0 8px;
	}
}

.skills-content {
	font-size: 12px;
	padding: 0 2px;
	margin-top: 0;
	column-count: 2;

	select, input {
		font-size: 11px;
		border: none;
		height: 21px;
	}

	.skill {
		padding: 3.3px 6px;

		.modifier { max-width: 30px; }

		.rollFreeSkill {
			position: absolute;
			left: 48%;
			width: 24px;
		}

		i { padding: 0 5px; }
	}
}

.resource .categoryCheck { display: flex; }
.resources { gap: 10px; margin: 5px 0; }
.invalid { position: relative; }

.item-alert {
	position: relative;
	border-radius: 5px;
	padding: 8px;
	margin: 10px 5px;
	background-color: aliceblue;
}

.item-editable-resource {
	display: inline-flex;
	align-items: center;
	justify-content: center;

	i { padding: 4px; }
	input {
		background: none;
		border: none;
	}
}


.biography {
	aside, div:first-of-type { padding: 2px; }

	.class, .trail { font-size: 12px; }

	fieldset {
		border: variables.$border-transparent;
		border-radius: 10px;
	}

	.bio-desc .editor { min-height: 230px; }
	.bio-goals .editor { min-height: 100px; }
}

.inventory {
	padding-bottom: 24px;
	overflow: hidden !important;
}

.ritual-dt {
	display: flex;
	justify-content: center;
	margin: 0 8px 8px;
	padding: 0 8px;
	border: 1px solid #b8b8b8;
	box-shadow: rgba(0, 0, 0, 0.05) 0 1px 2px 0;
	border-radius: 5px;
	text-align: center;

	p {
		font-family: typography.$op-optima;
		font-weight: bold;
	}
}

.threat {
	#senses, #defenses, #attributes, #general,
	#disturbingPresence, #actions, #abilities {
		padding: 5px;
		border: 1px solid $border-transparent-medium;
		margin-top: 5px;
		border-radius: 5px;

		.display-flex {
			align-items: center;
		}
	}

	.miniInput {
		width: 32px;
	}

	#attributes {
		justify-content: space-between;

		.pre, .vit, .str, .int, .dex {
			text-align: center;
			input {
				height: 32px;
			}
		}
	}

	label + input {
		margin-left: 5px;
	}

	#announcement {
		a { color: $border-dark; }
		.link-alert { padding: 0 10px; }
	}

	#descriptions div {
		margin: 8px 0;
		textarea { height: 200px; }
	}

	#actions textarea, #abilities textarea { height: 300px; }

	/* --- LAYOUT GERAL --- */
        .sheet-body { 
            height: 100%; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            container-type: inline-size;
        }
        
        .sheet-body .tab { 
            display: none; 
            height: 100%; 
            overflow-y: auto; 
            padding-right: 5px; 
        }
        .sheet-body .tab.active { display: block; }

        .sheet-tabs .item.active { text-decoration: underline; font-weight: bold; text-shadow: 0 0 5px var(--color-shadow-primary); }
        .sheet-tabs .item { display: flex; align-items: center; justify-content: center; gap: 5px; }
        .sheet-tabs .item img { border: none; margin: 0; padding: 0; vertical-align: middle; }

        /* --- IMAGEM E CABEÇALHO --- */
        .header-identify {
            flex-wrap: wrap;
            gap: 10px;
        }

        .threat-profile-img {
            flex: 0 0 110px;
            height: 110px;
            width: 110px;
            object-fit: cover;
            border: 1px solid #000;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 15px;
        }

        @container (max-width: 400px) {
            .header-identify { justify-content: center; }
            .threat-profile-img { margin-right: 0; margin-bottom: 5px; }
        }

        .header-stats-row {
            display: flex; 
            flex-wrap: wrap; 
            gap: 5px; 
            margin-top: 5px; 
            align-items: stretch; 
            width: 100%;
        }

        .disturbing-presence {
            background: rgba(0, 0, 0, 0.05); 
            border-radius: 5px; 
            border: 1px solid #ccc; 
            padding: 5px 10px; 
            flex: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 15px;
            flex-wrap: wrap;
        }

        /* --- ABA ENIGMA --- */
        .sheet-body .tab.enigma {
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden !important; 
        }

        .enigma-container {
            padding: 15px;
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid #999;
            border-radius: 5px;
            height: 100%; 
            display: flex;
            flex-direction: column;
            overflow-y: auto; 
        }

        .actor-title-header {
            font-size: 1.4em;
            font-weight: bold;
            border-bottom: 2px solid #333;
            margin-bottom: 10px;
            padding-bottom: 2px;
            display: block;
            text-transform: uppercase;
            color: #191813;
        }

        prose-mirror {
            min-height: 200px;
            flex: 1;
            background: rgba(255, 255, 255, 0.3);
            padding: 5px;
            border-radius: 4px;
            color: #191813;
        }

        /* --- PERÍCIAS (FIXADO EM 4 COLUNAS) --- */
        .threat-skills-container {
            margin-top: 5px; 
            display: grid; 
            /* Força exatamente 4 colunas de tamanho igual */
            grid-template-columns: repeat(4, 1fr); 
            gap: 5px; 
            justify-content: space-between;
        }

				.threat-tags {
					gap: 10px;
				}

        /* --- RESISTÊNCIAS --- */
        .resistance-container-grid, .traits-container-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            padding: 2px;
            align-items: center;
            justify-content: center;
            min-height: 30px;
        }

        .resistance-tag {
            flex: 1 0 auto;
            min-width: 60px;
            font-size: 10px; 
            border: 1px solid #7a7971; 
            padding: 2px; 
            border-radius: 4px; 
            background: rgba(0,0,0,0.05); 
            white-space: nowrap; 
            display: flex; 
            flex-direction: row; 
            align-items: center; 
            justify-content: center; 
            text-align: center;
						gap: 4px;

						.resistance-tag-label {
							font-weight: bold;
							text-transform: uppercase;
							font-size: 10px;
						}

						.resistance-tag-values {
							display: flex;
							gap: 3px;
							align-items: center;
							justify-content: center;
						}

						.resistance-tag-value {
							font-size: 11px;
							font-weight: bold;
						}

						.resistance-tag-immune {
							color: #2c3e50;
							font-size: 10px;
						}

						.resistance-tag-vulnerable {
							color: #c0392b;
							font-size: 10px;
						}
        }

				.traits-tag {
					flex: 1 0 auto;
					min-width: 60px;
					font-size: 10px; 
					border: 1px solid #7a7971; 
					padding: 2px; 
					border-radius: 4px; 
					background: rgba(0,0,0,0.05); 
					white-space: nowrap; 
					display: flex; 
					flex-direction: row; 
					align-items: center; 
					justify-content: center; 
					text-align: center;
					gap: 4px;
				}

				.traits-tag-label {
					font-weight: bold;
					text-transform: uppercase;
					font-size: 10px;
					margin-bottom: 1px;
				}

        .resource-content select { max-width: 100%; }
        .items-list .item { flex-wrap: wrap; }
}

// .item-form {
//   font-family: typography.$font-primary;
// }
.item {
	.sheet-header {
  flex: 0 auto;
  overflow: hidden;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: flex-start;
  margin-bottom: 10px;
	height: 180px;

		.profile-img {
			flex: 0 0 100px;
			height: 100px;
			margin-right: 10px;
		}

		.header-fields {
			display: flex;
			flex-direction: column;
			flex: 1;
			align-items: center;
			justify-content: center;

			.document-name {
				width: 100%;
			}
		}
	}

	.window-content {
		height: 100%;
	}

	.content {
		height: 100%;
  	overflow-y: auto;
	}

	.tab {
  	overflow-y: hidden;
  	height: 100%;
  	align-content: flex-start;
  	padding-right: 2px;
	}
}


/* ITEMS IN ACTOR SHEET (AGENT) */
.item-space {
	flex: 1 20px;
	padding: 0 8px;
}

.item-sheet {
	display: flex;
	flex: 1;
	background-color: aqua;
}

.item-image {
	perspective: 50px;

	img {
		border: 1px solid #00000070;
	}
}

.slide {
	overflow: hidden;

	& > img,
	a {
		transition: 0.3s all ease-in-out;
		position: absolute;
	}
	& > a {
		margin-left: 4px;
		font-size: 20px;
		transform: translate(50px, 0);
	}
	&:hover {
		& > img {
			transform: translate(-(200px), 0);
		}
		& > a {
			transform: translate(0, 0);
		}
	}
}
