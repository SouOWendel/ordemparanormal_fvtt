<section class="tab flexcol {{tab.cssClass}}" data-tab="abilities" data-group="primary">
	
	{{!-- 1. Botão de Controle --}}
	<div style="text-align: right; margin-bottom: {{#if mostrarRecursos}}2px{{else}}10px{{/if}}; padding-right: 5px;">
		<a data-action="toggleResources" title="Gerenciar Recursos" style="color: {{#if mostrarRecursos}}#d4af37{{else}}#555{{/if}}; text-decoration: none; font-size: 12px;">
			<i class="fas fa-boxes"></i> {{#if mostrarRecursos}}Ocultar Recursos{{else}}Gerir Recursos{{/if}}
		</a>
	</div>

	{{!-- 2. Área de Recursos (Aparece se estiver ativado) --}}
	{{#if mostrarRecursos}}
		<div class="ritual-dt" style="margin-bottom: 2px; padding: 4px; display: flex; justify-content: space-between; gap: 4px; align-items: flex-end;">
			{{!-- Recurso 1 --}}
			<div class="resource-item" style="display: flex; flex-direction: column; align-items: center; gap: 0; flex: 1;">
				<input type="text" name="system.resources.res1.label" value="{{system.resources.res1.label}}" placeholder="Recurso 1" style="border: none; background: transparent; text-align: center; font-weight: bold; font-family: 'Optima Nova LT PRO', 'Roboto', sans-serif; width: 100%; min-width: 0; color: inherit; margin: 0; padding: 0; height: auto;"/>
				<div style="display: flex; align-items: center; gap: 2px; justify-content: center;">
					<input type="number" name="system.resources.res1.value" value="{{system.resources.res1.value}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
					<span style="font-weight: bold;">/</span>
					<input type="number" name="system.resources.res1.max" value="{{system.resources.res1.max}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
				</div>
			</div>

			{{!-- Recurso 2 --}}
			<div class="resource-item" style="display: flex; flex-direction: column; align-items: center; gap: 0; flex: 1;">
				<input type="text" name="system.resources.res2.label" value="{{system.resources.res2.label}}" placeholder="Recurso 2" style="border: none; background: transparent; text-align: center; font-weight: bold; font-family: 'Optima Nova LT PRO', 'Roboto', sans-serif; width: 100%; min-width: 0; color: inherit; margin: 0; padding: 0; height: auto;"/>
				<div style="display: flex; align-items: center; gap: 2px; justify-content: center;">
					<input type="number" name="system.resources.res2.value" value="{{system.resources.res2.value}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
					<span style="font-weight: bold;">/</span>
					<input type="number" name="system.resources.res2.max" value="{{system.resources.res2.max}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
				</div>
			</div>

			{{!-- Recurso 3 --}}
			<div class="resource-item" style="display: flex; flex-direction: column; align-items: center; gap: 0; flex: 1;">
				<input type="text" name="system.resources.res3.label" value="{{system.resources.res3.label}}" placeholder="Recurso 3" style="border: none; background: transparent; text-align: center; font-weight: bold; font-family: 'Optima Nova LT PRO', 'Roboto', sans-serif; width: 100%; min-width: 0; color: inherit; margin: 0; padding: 0; height: auto;"/>
				<div style="display: flex; align-items: center; gap: 2px; justify-content: center;">
					<input type="number" name="system.resources.res3.value" value="{{system.resources.res3.value}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
					<span style="font-weight: bold;">/</span>
					<input type="number" name="system.resources.res3.max" value="{{system.resources.res3.max}}" placeholder="0" style="width: 30px; text-align: center; border: none; border-bottom: 1px solid #888; background: transparent; height: 20px; color: inherit; padding: 0;"/>
				</div>
			</div>
		</div>
	{{/if}}

	{{!-- ===================================================== --}}
	{{!-- LISTA DE HABILIDADES --}}
	{{!-- ===================================================== --}}
	<div class="abilities-details">
		<ol class="items-list main-items">
			{{#each abilities.valid as |section type|}}

				{{!-- Cabeçalho da Seção (Origem, Classe, etc) --}}
				<li class="item flexrow items-header">
					<div class="item-name">
						{{#ifEquals type 1}}{{localize "op.abilitiesAbv.origin"}}{{/ifEquals}}
						{{#ifEquals type 2}}{{localize "op.abilitiesAbv.class"}}{{/ifEquals}}
						{{#ifEquals type 3}}{{localize "op.abilitiesAbv.path"}}{{/ifEquals}}
						{{#ifEquals type 4}}{{localize "op.abilitiesAbv.paranormal"}}{{/ifEquals}}
						{{#ifEquals type 5}}{{localize "op.abilitiesAbv.general"}}{{/ifEquals}}
						{{#ifEquals type 6}}{{localize "op.abilitiesAbv.complication"}}{{/ifEquals}}
						{{#ifEquals type 7}}{{localize "op.abilitiesAbv.ability"}}{{/ifEquals}}
					</div>

					{{!-- Colunas com Tamanho Fixo --}}
					<div class="item-formula" style="flex: 0 0 120px;">{{localize "op.type"}}</div>
					<div class="item-formula" style="flex: 0 0 80px;">{{localize "op.cost"}}</div>
					<div class="item-formula" style="flex: 0 0 100px;">{{localize "op.execution"}}</div>

					<div class="item-controls">
						{{#if @root.editable}}
							<a class="item-control item-create"
							data-action="createDoc"
							title="Create item"
							data-document-class="Item"
							data-type="ability"
							data-id="{{type}}"
							data-system.ability-Type="{{abilityTypeHelper type}}">
								<i class="fas fa-plus"></i>
							</a>
						{{/if}}
					</div>
				</li>

				{{!-- Loop dos Itens --}}
				{{#each section as |item id|}}
					<li class="item draggable" data-document-class="Item" data-item-id="{{item._id}}" style="display: flex; flex-direction: column; height: auto;">

						{{!-- Linha Principal do Item --}}
						<div class="flexrow item-row" style="width: 100%; align-items: center;">
							<div class="item-name flexrow">
								{{!-- Imagem (Slide + Roll) --}}
								<div class="item-image slide">
									<img src="{{item.img}}" title="{{item.name}}" width="24" height="24" class="item-toggle" style="cursor: pointer;"/>
									<a class="rollable" data-roll-type="item" data-action="onRoll">
										<i class="fa-solid fa-dice-d20"></i>
									</a>
								</div>
								{{!-- Nome (Clique p/ Expandir) --}}
								<h4 class="item-toggle" style="cursor: pointer;">{{item.name}}</h4>
							</div>

							{{!-- Colunas de Dados --}}
							<div class="item-formula item-prop" style="flex: 0 0 120px; font-size: 11px;">
								{{#if item.system.abilityType}}
									{{localize (concat "op.powerTypeChoices." item.system.abilityType)}}
								{{else}}—{{/if}}
							</div>

							<div class="item-formula item-prop" style="flex: 0 0 80px; font-size: 11px;">
								{{item.displayCost}}
							</div>

							<div class="item-formula item-prop" style="flex: 0 0 100px; font-size: 11px;">
								{{item.activationLabel}}
							</div>

							<div class="item-controls">
								<a class="item-control item-edit" data-action="viewDoc" title="Edit Item"><i class="fas fa-edit"></i></a>
								<a class="item-control" data-action="deleteDoc" title="Delete Item"><i class="fas fa-trash"></i></a>
							</div>
						</div>

						{{!-- Descrição Oculta --}}
						<div class="item-description" style="display: none; width: 100%; padding: 5px 10px; border-top: 1px dashed #777; margin-top: 5px; font-size: 0.9em; text-align: left;">
							{{{item.system.description}}}
						</div>
					</li>
				{{/each}}
			{{/each}}
		</ol>

		{{!-- ITENS INVÁLIDOS / OUTROS --}}
		{{#if abilities.invalid}}
			<section class="invalid">
				<div class="item-alert">Outros Itens</div>
				<ol class="items-list">
					{{#each abilities.invalid as |item id|}}
						<li class="item draggable" data-document-class="Item" data-item-id="{{item._id}}" style="display: flex; flex-direction: column; height: auto;">
							<div class="flexrow item-row" style="width: 100%; align-items: center;">
								<div class="item-name flexrow">
									<div class="item-image slide">
										<img src="{{item.img}}" title="{{item.name}}" width="24" height="24" class="item-toggle" style="cursor: pointer;"/>
										<a class="rollable" data-roll-type="item" data-action="onRoll">
											<i class="fa-solid fa-dice-d20"></i>
										</a>
									</div>
									<h4 class="item-toggle" style="cursor: pointer;">{{item.name}}</h4>
								</div>
								<div class="item-formula item-prop">{{item.system.cost}}</div>
								<div class="item-formula item-prop">
									{{#if item.system.activation}}
										{{localize (concat "op.executionChoices." item.system.activation)}}
									{{/if}}
								</div>
								<div class="item-controls">
									<a class="item-control item-edit" data-action="viewDoc" title="Edit Item"><i class="fas fa-edit"></i></a>
									<a class="item-control" data-action="deleteDoc" title="Delete Item"><i class="fas fa-trash"></i></a>
								</div>
							</div>
							<div class="item-description" style="display: none; width: 100%; padding: 5px 10px; border-top: 1px dashed #777; margin-top: 5px; font-size: 0.9em; text-align: left;">
								{{{item.system.description}}}
							</div>
						</li>
					{{/each}}
				</ol>
			</section>
		{{/if}}
	</div>

</section>